<?xml version="1.0" encoding="UTF-8" ?>
<xsl:stylesheet xml:id="latex" version="1.0"
        xmlns:book="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns:dion="http://avoceteditors.com/xml/dion">
<xsl:output method="text" omit-xml-declaration="yes" indent="no"/>


<!-- Books -->
<xsl:template match="/book:book[@role='novel']">
\documentclass[<xsl:value-of select="@dion:font"/>, <xsl:value-of select="@dion:paper"/>, <xsl:value-of select="@dion:sides"/>]{book}
\usepackage[book, hidetitles, gothrubric]{dion}

% Variables
\setTitle{<xsl:value-of select="book:title|book:info/book:title"/>}
\setAuthor{<xsl:value-of select="book:info/book:author"/>}
\setSurname{<xsl:value-of select="book:info/book:author//book:surname"/>}
\setSubtitle{<xsl:value-of select="book:info/book:subtitle"/>}
\setPublisher{<xsl:value-of select="book:info/book:publisher/book:publishername"/>}
\setPubcities{<xsl:for-each select="book:info/book:publisher//book:city"><xsl:value-of select="."/><xsl:if test="position() != last()"> \tiny + \normalsize </xsl:if></xsl:for-each>}

%%%%%%%%%%%%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\diontitlepage

\tableofcontents

<xsl:apply-templates/>

\end{document}
</xsl:template>

<xsl:template match="/book:book[@role='book']">
\documentclass[<xsl:value-of select="@dion:font"/>, <xsl:value-of select="@dion:paper"/>, <xsl:value-of select="@dion:sides"/>]{book}
\usepackage[book, hidetitles, gothrubric]{dion}

% Variables
\setTitle{<xsl:value-of select="book:title|book:info/book:title"/>}
\setAuthor{<xsl:value-of select="book:info/book:author"/>}
\setSurname{<xsl:value-of select="book:info/book:author//book:surname"/>}
\setSubtitle{<xsl:value-of select="book:info/book:subtitle"/>}
\setPublisher{<xsl:value-of select="book:info/book:publisher/book:publishername"/>}
\setPubcities{<xsl:for-each select="book:info/book:publisher//book:city"><xsl:value-of select="."/><xsl:if test="position() != last()"> \tiny + \normalsize </xsl:if></xsl:for-each>}

%%%%%%%%%%%%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\diontitlepage

\tableofcontents

<xsl:apply-templates/>

\end{document}
</xsl:template>

<!-- Chapters -->
<xsl:template match="/book:chapter">
\documentclass[<xsl:value-of select="@dion:font"/>, letterhead, oneside]{book}
\usepackage[book, hidetitles, gothrubric]{dion}

% Variables
\setTitle{<xsl:value-of select="book:info/dion:booktitle"/>}
\setAuthor{<xsl:value-of select="book:info/book:author"/>}
\setSurname{<xsl:value-of select="book:info/book:author//book:surname"/>}
\setSubtitle{<xsl:value-of select="book:info/book:subtitle"/>}
\setPublisher{<xsl:value-of select="book:info/book:publisher/book:publishername"/>}
\setPubcities{<xsl:for-each select="book:info/book:publisher//book:city"><xsl:value-of select="."/><xsl:if test="position() != last()"> \tiny + \normalsize </xsl:if></xsl:for-each>}

%%%%%%%%%%%%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\chapter*{<xsl:value-of select="book:info/book:title|book:title"/>}

<xsl:if test="@role='novel'">
\titleblock{<xsl:value-of select="book:info/dion:titleblock"/>}
</xsl:if>
<xsl:apply-templates/>

\end{document}
</xsl:template>

<!-- Sections -->
<dion:include src="sections.xml"/>

<!-- Blocks -->
<dion:include src="blocks.xml"/>

<!-- Inline -->
<dion:include src="inline.xml"/>

</xsl:stylesheet>
