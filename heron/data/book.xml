<?xml version="1.0" encoding="UTF-8" ?>
<xsl:stylesheet version="1.0"
        xmlns:book="http://docbook.org/ns/docbook"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns:dion="http://avoceteditors.com/xml/dion">
<xsl:output method="text" omit-xml-declaration="yes" index="no"/>

<xsl:template match="/book:book[@role='novel']">\documentclass[<xsl:value-of select="@dion:font"/>, <xsl:value-of select="@dion:paper"/>, <xsl:value-of select="@dion:sides"/>]{book}
\usepackage[book, hidetitles, gothrubric]{dion} 

\setTitle{<xsl:value-of select="book:title|book:info/book:title"/>}
\setAuthor{<xsl:value-of select="book:info/book:author"/>}

\setSurname{<xsl:value-of select="book:info/book:author/book:personname/book:surname"/>}

\setSubtitle{<xsl:value-of select="book:info/book:subtitle"/>}

\setPublisher{<xsl:value-of select="book:info/book:publisher/book:publishername"/>}

\setPubcities{<xsl:for-each select="book:info/book:publisher//book:city"><xsl:value-of select="."/><xsl:if test="position() != last()"> \tiny + \normalsize </xsl:if></xsl:for-each>}

\begin{document}

\diontitlepage

\tableofcontents

<xsl:apply-templates/>

\end{document}
</xsl:template>



<xsl:template match="/book:book[@role='book']">\documentclass[<xsl:value-of select="@dion:font"/>, <xsl:value-of select="@dion:paper"/>, <xsl:value-of select="@dion:sides"/>]{book}
\usepackage[book, showtitles]{dion} 

<!--
<xsl:value-of select="dion:preamble"/>
\pagestyle{fancy}
\fancyhead[RO]{\footnotesize <xsl:value-of select="book:info/book:author//book:surname"/> \normalsize}
\fancyhead[LE]{\footnotesize \textsc{<xsl:value-of select="book:info/book:title"/>}\normalsize}
\fancyhead[LO, RE, CO, CE]{}
\fancyfoot[LE, RO]{\footnotesize \thepage \normalsize}
\fancyfoot[LO, RE, CO, CE]{}
-->
<xsl:if test="@dion:index='yes'">
\makeindex
</xsl:if>

% Document
\begin{document}

<!--
% Tile Page
\begin{titlepage}
\begin{center}

\vspace{2in}
\bfseries 
\Large\MakeUppercase{<xsl:value-of select="book:info/book:title"/>}

\vspace{1in}
\large\emph{<xsl:value-of select="book:info/book:subtitle"/>}

\vspace{4.4in}
<xsl:value-of select="book:info/book:author/book:personname"/>

\vspace{0.5in}
\rule{0.75\textwidth}{0.4pt}

\normalsize\emph{<xsl:value-of select="book:info/book:publisher/book:publishername"/>}

\small <xsl:for-each select="book:info/book:publisher//book:city"><xsl:value-of select="."/><xsl:if test="position() != last()"> \tiny + \normalsize </xsl:if></xsl:for-each> 
\end{center}
\end{titlepage}

\tableofcontents
-->

<xsl:apply-templates/>

\end{document}
</xsl:template>

<xsl:template match="dion:preamble|dion:titles|book:info"/>


<!-- Compiled Section Matches -->
<dion:include src="section.xml"/>

<!-- Blocks -->
<dion:include src="block.xml"/>

<!-- Inline -->
<dion:include src="inline.xml"/>

</xsl:stylesheet>
